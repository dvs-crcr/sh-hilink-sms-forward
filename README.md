# Hilink SMS Forward bash scripts
[![Software License](https://img.shields.io/badge/license-MIT-brightgreen.svg)](LICENSE)

## Описание
Набор скриптов для форвардинга СМС сообщений методом POST в JSON формате на сторонний API, а также получение заданий на выполнение скриптов от удаленного серевера (бывает полезно для перезагрузки или для других действий с девайсом). Пригоден для использования в USB-модемах E3372 известной китайской компании c кастомной прошивкой Hilink. Например, можно пересылать сообщения в мессенджер telegram, в свою CRM-сисетму или включать и отключать tinc vpn :)


## Структура

* ip - ip-адрес удаленного сервра
* api_key - ключ или токен для работы с API удаленного сервера (идентификация устройства на стороне сервера)
* hilink.sh - набор команд для взаимодействия с API модема
* sms.sh - скрипт, который проверяет раз в N секунд наличие новых(непрочитанных) СМС-сообщений (По-дефолту: 10сек)
* red.sh - скрипт, который проверяет раз в N секунд наличие новых заданий на удаленном сервере (По-дефолту: 10сек)
* commands.sh - скрипт с наборои команд, которые нужно выполнить при получении от сервера
* checker.sh & check_proc.sh - скрипты для проверки того, что `sms.sh` и `red.sh` запущены


## Алгоритм работы

1. Кроном запускаем скрипт `checker.sh` с интервалом в 1 минуту
2. Стартуем `sms.sh` и `red.sh`
3. Раз в N-секунд проверяем налачие SMS и делаем их форвард
4. Раз в N-секунд проверяем налачие заданий от сервера и выполняем их

0. В случае ребута девайса кроном через миуту поднимет скрипты

## Добавить проверку в Cron
```
mkdir /var/spool/
mkdir /var/spool/cron
mkdir /var/spool/cron/crontabs
mkdir /data
mkdir /data/root-home
mkdir /tmp
echo "*/1 * * * * /bin/sh /root/checker.sh > /dev/null &">/var/spool/cron/crontabs/root
busybox crond
```
Источник: https://4pda.ru/forum/index.php?showtopic=582284&st=11560#entry49700284

## Обратите внимание!

* Предполагается, что скрипты расположены в папке `/root`. Если у вас это не так, то вам надо ковырять код.
* Обратите внимание на переменную URL в скриптах `sms.sh`, `red.sh` и `commands.sh`. Она указывает на адрес вашей API, скорее всего, ее нужно будет модифицировать.
* Если что-то меняете, то внимательно следите за кодировкой! Все должно быть исключительно в UTF-8

## Changelog

`2020-09-28`
* Релиз версии 1.0.0